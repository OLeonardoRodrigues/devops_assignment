# DevOps Test 1 â€“ Terraform (Candidate Instructions)

This test uses Terraform with the `hashicorp/local` provider.
In `main.tf` you will find a very simple example that creates a single file for the `QA` environment.

Your task is to extend this configuration.

## Goal

Modify the Terraform configuration so that it creates:

- Three environments: `QA`, `STG`, and `PRD`.
- For **each** environment, **10 files** named:
  - `file1.txt`, `file2.txt`, ..., `file10.txt`
- Each file must live under its environment folder, for example:
  - `QA/file1.txt`, ..., `QA/file10.txt`
  - `STG/file1.txt`, ..., `STG/file10.txt`
  - `PRD/file1.txt`, ..., `PRD/file10.txt`

The exact content of each file is up to you, but it should be clearly related to the environment and/or file number.

Example:
QA/file1.txt
-   content  = "This is file number 1 for QA env generated by terraform, The user inputed text is : I will do well here"

QA/file10.txt
-   content  = "This is file number 10 for QA env generated by terraform, The user inputed text is : See its easy"

## How to run

You can assume Terraform is already installed.

1. Initialize:

   terraform init

2. Review the execution plan:

   terraform plan

3. Apply the changes (only if you are comfortable):

   terraform apply

After applying, you should see the generated files under the corresponding environment folders (`QA/`, `STG/`, `PRD/`).

## Take notes for what and why you did.

### #1 Organization

The directory structure was rethinked to separate concerns clearly and follow common Terraform repository conventions.

New directory structure:
```
data.tf
variables.tf
locals.tf
main.tf
outputs.tf
providers.tf
versions.tf
```

This structure improves readability, maintainability, scalability and favor consistency.

Keeping files such as `data.tf` in the structure

### #2 Versioning

The version constraints were set to:
- Local Provider: "~> 2.6"
- Terraform: "~> 1.14"

This ensures compatibility within the same minor release while preventing breaking changes from newer minor versions.

Version constraints provide reproducibility, predictability, safer upgrades and CI/CD stability.

### #3 Set Variables

The variables are defined to make the configuration flexible, explicit, and safe while avoiding hardcoding.

Every variable was set with explicit flags to make intent clear and keep consistency.

### #4 Building the Env/Number combinations

The local `combinations` uses `setproduct()` creates every possible pair between the lists of environment and file numbers.

The local `files` converts the local `combinations` into a map with unique keys which is a requirement to use `for_each`.

### #5 Creating the Files Dinamically

The `generated_files` resource with `for_each = local.files` creates a resource for each combination in the local `files`.

The `user_texts` is added to each file based on the environment it was created for.

### #6 Set Outputs

The outputs are defined to expose useful information after terraform apply, making validation and debugging easier.

Each output was configured with explicit flags (sensitive and ephemeral) to clearly define behavior and intent.

### #7 Run Terraform Init/Plan/Apply

After all of the configuration, the following steps were done:

1. `terraform init`: which initialized the module and created [`.terraform.lock.hcl`](.terraform.lock.hcl)
2. `terraform plan -out=plan.tfplan`: which created [`plan.tfplan`](plan.tfplan)
3. `terraform apply plan.tfplan`: which created the files as expected, the logs of this process are available at [`tf-apply-logs.txt`](tf-apply-logs.txt)

### #8 Export terraform outputs

The values of the outputs generated were exported to json using the command below:
`terraform output -json > output_values.json`

This was done to further document the outcome and the process as a whole.

### #9 Generate README.md using terraform-docs

The tool terraform-docs generates automatic documentation for a Terraform module.

Its configuration comes from the file [`.terraform-docs.yml`](.terraform-docs.yml) and it can be executed by running the command below from the root of the repository:

`terraform-docs .`

This will generate a new version of the [`README.md`](README.md) file.

## We will discuss it later.
